@using Mzayad.Web.Extensions
@model Mzayad.Web.Areas.Admin.Models.Users.EditSubscriptionViewModel

@{
    ViewBag.Title = "Edit Subscription";
}

@helper  GetSubscription()
{
    if (!Model.User.SubscriptionUtc.HasValue)
    {
        <div class="text-warning">Never Subscribed</div>
    }
    else
    {
        if (Model.User.SubscriptionUtc.Value > DateTime.Now)
        {
            <div>
                <span class="text-success">ACTIVE </span> until @Model.User.SubscriptionUtc.Value.ToString("dd MMM yyyy HH:mm")
            </div>
        }
        else
        {
            <div>
                <span class="text-danger">EXPIRED </span> on @Model.User.SubscriptionUtc.Value.ToString("dd MMM yyyy HH:mm")
            </div>
        }
    }

}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <section>

        <div class="form-group">
            @Html.Label("Current Subscription")
            <p class="form-control-static">
                @GetSubscription()
            </p>
        </div>

        <div class="form-group">
            @Html.LabelFor(i => i.CurrentSubscription, "New Subscription")
            <div class="row">
                <div class="col-md-3">
                    @Html.EditorFor(i => i.CurrentSubscription)
                </div>
                <div class="col-md-2 text-right" style="padding-top: 5px;">
                    <a href="#" id="btnAddDays"> <span class="fa fa-chevron-left"></span>&nbsp;&nbsp; Add Days</a>
                </div>
                <div class="col-md-2">
                    @Html.TextBoxFor(i=>i.AddDays,new {@class="form-control" , @type="number"})
                </div>
            </div>
            @Html.ValidationMessageFor(i => i.CurrentSubscription, "Please enter a subscription date.")
        </div>

    </section>

    <section class="form-buttons">
        <button type="submit" class="btn btn-default">Save</button>
    </section>
    
    @Html.HiddenFor(i=>i.User.Id)
}

@section scripts {
    @Scripts.Render("~/js/validate")
    <script type="text/javascript">
        $(function() {

            $(".date-picker").datepicker({ minDate: 0, dateFormat: 'dd/mm/yy' });

            $("#btnAddDays").click(function() {
                var $datePicker = $(".date-picker");
                var $addDayTxt = $("#AddDays");
                var parts = $datePicker.val().split('/');
                var cureentDate = new Date(parts[2], parts[1] - 1, parts[0],0,0,0,0);
                cureentDate.setDate(cureentDate.getDate() + parseInt($addDayTxt.val()));
                var date_str = $.datepicker.formatDate('dd/mm/yy', cureentDate);
                $datePicker.val(date_str);

            });

        });
    </script>
}



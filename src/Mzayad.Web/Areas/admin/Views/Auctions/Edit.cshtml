@using Humanizer
@using Mzayad.Core.Formatting
@using Mzayad.Web.Extensions
@using OrangeJetpack.Base.Core.Formatting
@using DateTimeFormatter = Mzayad.Core.Formatting.DateTimeFormatter
@model Mzayad.Web.Areas.admin.Models.Auctions.AddEditViewModel
@{
    ViewBag.Title = "Edit Auction";
}

<ul class="link-list">
    <li><a href="@Url.Action("Delete", "Auctions", new {id = @Model.Auction.AuctionId})">Delete Auction</a></li>
</ul>

@Html.Partial("_AddEditAuction")

@if (Model.Bids.Any())
{
    <section>
        <h2>Bids History</h2>
        <table class="@Html.Css().GridTable">
            <thead>
                <tr>
                    <th>Date\Time</th>
                    <th>User</th>
                    <th>Amount</th>
                    <th>Time Left in Auction</th>
                    <th>Type</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var bid in Model.Bids)
                {
                    <tr>
                        <td>@DateTimeFormatter.ToLocalTime(bid.CreatedUtc, DateTimeFormatter.Format.Full)</td>
                        <td>@NameFormatter.GetFullName(bid.User.FirstName, bid.User.LastName)</td>
                        <td>@CurrencyFormatter.Format(bid.Amount)</td>
                        <td>@TimeSpan.FromSeconds(bid.SecondsLeft).Humanize(4)</td>
                        <td>
                            @if (Model.AutoBids.Any(i => i.UserId == bid.UserId))
                            {
                                <span class="label label-success">Auto Bid</span>
                            }
                            else
                            {
                                <span class="label label-default">Manual</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </section>
}

@section scripts {
    <script>

        var toggleBuyNow = function () {
            var checkbox = $("#Auction_BuyNowEnabled");
            var section = checkbox.parents("section");
            var formGroups = section.find(".form-group-disableable");
            var formControls = formGroups.find(".form-control");

            if (checkbox.is(":checked")) {
                formGroups.removeClass("form-group-disabled");
                formControls.prop("disabled", false);
            } else {
                formGroups.addClass("form-group-disabled");
                formControls.prop("disabled", true);
            }
        }

        $(function () {
            $("#Auction_BuyNowEnabled").on("change", toggleBuyNow);
            toggleBuyNow();
        });

    </script>
}